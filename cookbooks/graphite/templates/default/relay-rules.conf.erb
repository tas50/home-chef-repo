# Generated by Chef

# Relay destination rules for carbon-relay. Entries are scanned in order,
# and the first pattern a metric matches will cause processing to cease after sending
# unless `continue` is set to true
#
#  [name]
#  pattern = <regex>
#  destinations = <list of destination addresses>
#  continue = <boolean>  # default: False
#
#  name: Arbitrary unique name to identify the rule
#  pattern: Regex pattern to match against the metric name
#  destinations: Comma-separated list of destinations.
#    ex: 127.0.0.1, 10.1.2.3:2004, 10.1.2.4:2004:a, myserver.mydomain.com
#  continue: Continue processing rules if this rule matches (default: False)

# You must have exactly one section with 'default = true'
# Note that all destinations listed must also exist in carbon.conf
# in the DESTINATIONS setting in the [relay] section
<% @relay_rules.each do |rule| -%>
[<%= rule['name'] %>]
<%   if rule['default'] and not rule['default'] == false -%>
default = true
<%   elsif rule['pattern'] -%>
pattern = <%= rule['pattern'].kind_of?(Regexp) ? rule['pattern'].source : rule['pattern'].to_s %>
<%     if rule['continue'] -%>
continue = <%= rule['continue'].to_s.capitalize %>
<%     end -%>
<%   end -%>
<%   if rule['destinations'] -%>
destinations = <%= rule['destinations'].kind_of?(Array) ? rule['destinations'].join(', ') : rule['destinations'].to_s %>
<%   end -%>

<% end -%>
